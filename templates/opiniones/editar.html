{% extends "base.html" %} {% block title %}Editar Opinión - Rentflow{% endblock
%} {% block content %}
<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-lg-6">
      <div class="card shadow">
        <div class="card-header bg-warning text-dark">
          <h4 class="mb-0"><i class="bi bi-pencil"></i> Editar Tu Opinión</h4>
        </div>
        <div class="card-body p-4">
          <p class="text-muted mb-4">
            Puedes modificar tu opinión sobre este objeto. Los cambios serán
            visibles inmediatamente.
          </p>

          <form method="POST">
            {{ form.hidden_tag() }}

            <!-- Calificación -->
            <div class="mb-4 text-center">
              <label class="form-label d-block mb-3">
                <strong>Calificación actual:</strong>
              </label>
              <div class="rating-stars mb-3" style="font-size: 2rem">
                {% for i in range(1, 6) %}
                <span
                  class="star"
                  data-rating="{{ i }}"
                  style="cursor: pointer; color: {% if i <= form.calificacion.data %}#ffc107{% else %}#ddd{% endif %};"
                >
                  <i
                    class="bi bi-star{% if i <= form.calificacion.data %}-fill{% endif %}"
                  ></i>
                </span>
                {% endfor %}
              </div>
              {{ form.calificacion(class="d-none") }} {% if
              form.calificacion.errors %}
              <div class="text-danger small">
                {% for error in form.calificacion.errors %} {{ error }} {%
                endfor %}
              </div>
              {% endif %}
              <div
                id="rating-text"
                class="small {% if form.calificacion.data >= 4 %}text-success {% elif form.calificacion.data >= 3 %}text-warning {% else %}text-danger{% endif %}"
              >
                {% if form.calificacion.data == 1 %}Muy malo - No cumplió
                expectativas {% elif form.calificacion.data == 2 %}Malo - Podría
                mejorar {% elif form.calificacion.data == 3 %}Regular - Cumplió
                lo básico {% elif form.calificacion.data == 4 %}Bueno - Superó
                expectativas {% elif form.calificacion.data == 5 %}Excelente -
                Excepcional {% else %}Selecciona una calificación{% endif %}
              </div>
            </div>

            <!-- Comentario -->
            <div class="mb-4">
              {{ form.comentario.label(class="form-label") }} {{
              form.comentario(class="form-control", rows="5",
              placeholder="Comparte tu experiencia...") }}
              <div class="form-text">
                Tu comentario actualizado será visible para todos los usuarios.
              </div>
              {% if form.comentario.errors %}
              <div class="text-danger small">
                {% for error in form.comentario.errors %} {{ error }} {% endfor
                %}
              </div>
              {% endif %}
            </div>

            <!-- Información de la opinión -->
            <div class="alert alert-info">
              <h6>
                <i class="bi bi-info-circle"></i> Información de la opinión:
              </h6>
              <ul class="mb-0 small">
                <li><strong>Objeto:</strong> {{ opinion.objeto.nombre }}</li>
                <li>
                  <strong>Fecha original:</strong> {{
                  opinion.fecha.strftime('%d/%m/%Y') }}
                </li>
                <li><strong>Última actualización:</strong> Hoy</li>
              </ul>
            </div>

            <!-- Botones -->
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
              <a
                href="{{ url_for('objetos.detalle_objeto', id=opinion.id_objeto) }}"
                class="btn btn-outline-secondary me-md-2"
              >
                <i class="bi bi-arrow-left"></i> Cancelar
              </a>
              <button type="submit" class="btn btn-warning me-md-2">
                <i class="bi bi-check-circle"></i> Guardar Cambios
              </button>
              <a
                href="{{ url_for('opiniones.eliminar_opinion', id=opinion.id_opinion) }}"
                class="btn btn-outline-danger"
                onclick="return confirm('¿Estás seguro de que quieres eliminar esta opinión?')"
              >
                <i class="bi bi-trash"></i> Eliminar
              </a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Script para el sistema de estrellas -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const stars = document.querySelectorAll(".star");
    const ratingInput = document.getElementById("{{ form.calificacion.id }}");
    const ratingText = document.getElementById("rating-text");

    const ratingTexts = {
      1: "Muy malo - No cumplió expectativas",
      2: "Malo - Podría mejorar",
      3: "Regular - Cumplió lo básico",
      4: "Bueno - Superó expectativas",
      5: "Excelente - Excepcional",
    };

    stars.forEach((star) => {
      star.addEventListener("click", function () {
        const rating = this.getAttribute("data-rating");
        ratingInput.value = rating;

        // Actualizar estrellas visualmente
        stars.forEach((s) => {
          const starRating = s.getAttribute("data-rating");
          if (starRating <= rating) {
            s.innerHTML = '<i class="bi bi-star-fill"></i>';
            s.style.color = "#ffc107";
          } else {
            s.innerHTML = '<i class="bi bi-star"></i>';
            s.style.color = "#ddd";
          }
        });

        // Actualizar texto
        ratingText.textContent = ratingTexts[rating];
        ratingText.className =
          "small " +
          (rating >= 4
            ? "text-success"
            : rating >= 3
            ? "text-warning"
            : "text-danger");
      });

      // Efecto hover
      star.addEventListener("mouseenter", function () {
        const hoverRating = this.getAttribute("data-rating");
        stars.forEach((s) => {
          const starRating = s.getAttribute("data-rating");
          if (starRating <= hoverRating) {
            s.style.color = "#ffc107";
          }
        });
      });

      star.addEventListener("mouseleave", function () {
        const currentRating = ratingInput.value;
        stars.forEach((s) => {
          const starRating = s.getAttribute("data-rating");
          if (!currentRating || starRating > currentRating) {
            s.style.color = "#ddd";
          }
        });
      });
    });
  });
</script>
{% endblock %}
