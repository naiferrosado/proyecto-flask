{% extends "base.html" %} {% block title %}Panel de Administración - Rentflow{%
endblock %} {% block content %}
<div class="container-fluid py-4">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h2">
      <i class="bi bi-speedometer2"></i> Panel de Administración
    </h1>
    <div class="text-muted">
      <i class="bi bi-person-circle"></i> {{ current_user.nombre }} {{
      current_user.apellido }}
    </div>
  </div>

  <!-- Estadísticas Rápidas -->
  <div class="row mb-4">
    <div class="col-xl-2 col-md-4 col-sm-6 mb-4">
      <div class="card border-start border-primary border-4 shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div
                class="text-xs font-weight-bold text-primary text-uppercase mb-1"
              >
                Usuarios Totales
              </div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">
                {{ stats.total_usuarios }}
              </div>
            </div>
            <div class="col-auto">
              <i class="bi bi-people fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-2 col-md-4 col-sm-6 mb-4">
      <div class="card border-start border-success border-4 shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div
                class="text-xs font-weight-bold text-success text-uppercase mb-1"
              >
                Objetos Activos
              </div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">
                {{ stats.total_objetos }}
              </div>
            </div>
            <div class="col-auto">
              <i class="bi bi-grid fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-2 col-md-4 col-sm-6 mb-4">
      <div class="card border-start border-warning border-4 shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div
                class="text-xs font-weight-bold text-warning text-uppercase mb-1"
              >
                Reservas Activas
              </div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">
                {{ stats.total_reservas }}
              </div>
            </div>
            <div class="col-auto">
              <i class="bi bi-calendar-check fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-2 col-md-4 col-sm-6 mb-4">
      <div class="card border-start border-info border-4 shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div
                class="text-xs font-weight-bold text-info text-uppercase mb-1"
              >
                Ingresos Hoy
              </div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">
                RD$ {{ "%.2f"|format(stats.ingresos_hoy) }}
              </div>
            </div>
            <div class="col-auto">
              <i class="bi bi-currency-dollar fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-2 col-md-4 col-sm-6 mb-4">
      <div class="card border-start border-danger border-4 shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div
                class="text-xs font-weight-bold text-danger text-uppercase mb-1"
              >
                Incidencias
              </div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">
                {{ stats.incidencias_pendientes }}
              </div>
            </div>
            <div class="col-auto">
              <i class="bi bi-exclamation-triangle fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-2 col-md-4 col-sm-6 mb-4">
      <div
        class="card border-start border-secondary border-4 shadow h-100 py-2"
      >
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div
                class="text-xs font-weight-bold text-secondary text-uppercase mb-1"
              >
                Objetos Pendientes
              </div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">
                {{ stats.objetos_pendientes }}
              </div>
            </div>
            <div class="col-auto">
              <i class="bi bi-clock fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- Menú de Administración -->
    <div class="col-lg-3 mb-4">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h6 class="mb-0">
            <i class="bi bi-menu-button"></i> Menú de Administración
          </h6>
        </div>
        <div class="list-group list-group-flush">
          <a
            href="{{ url_for('admin.usuarios') }}"
            class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
          >
            <div><i class="bi bi-people me-2"></i> Gestión de Usuarios</div>
            <span class="badge bg-primary rounded-pill"
              >{{ stats.total_usuarios }}</span
            >
          </a>

          <a
            href="{{ url_for('admin.objetos') }}"
            class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
          >
            <div><i class="bi bi-grid me-2"></i> Moderación de Objetos</div>
            {% if stats.objetos_pendientes > 0 %}
            <span class="badge bg-warning rounded-pill"
              >{{ stats.objetos_pendientes }}</span
            >
            {% else %}
            <span class="badge bg-secondary rounded-pill"
              >{{ stats.total_objetos }}</span
            >
            {% endif %}
          </a>

          <a
            href="{{ url_for('admin.categorias') }}"
            class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
          >
            <div><i class="bi bi-tags me-2"></i> Gestión de Categorías</div>
            <span class="badge bg-secondary rounded-pill"
              >{{ stats.total_categorias }}</span
            >
          </a>

          <a
            href="{{ url_for('admin.incidencias') }}"
            class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
          >
            <div>
              <i class="bi bi-exclamation-triangle me-2"></i> Incidencias
            </div>
            {% if stats.incidencias_pendientes > 0 %}
            <span class="badge bg-danger rounded-pill"
              >{{ stats.incidencias_pendientes }}</span
            >
            {% else %}
            <span class="badge bg-success rounded-pill">0</span>
            {% endif %}
          </a>

          <a
            href="{{ url_for('admin.reportes') }}"
            class="list-group-item list-group-item-action"
          >
            <i class="bi bi-graph-up me-2"></i> Reportes y Estadísticas
          </a>

          <a
            href="{{ url_for('admin.configuracion') }}"
            class="list-group-item list-group-item-action"
          >
            <i class="bi bi-gear me-2"></i> Configuración del Sistema
          </a>
        </div>
      </div>

      <!-- Acciones Rápidas -->
      <div class="card mt-4">
        <div class="card-header bg-success text-white">
          <h6 class="mb-0"><i class="bi bi-lightning"></i> Acciones Rápidas</h6>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            {% if stats.objetos_pendientes > 0 %}
            <a
              href="{{ url_for('admin.objetos') }}?estado=pendiente"
              class="btn btn-warning btn-sm"
            >
              <i class="bi bi-eye"></i> Revisar {{ stats.objetos_pendientes }}
              Objetos
            </a>
            {% endif %} {% if stats.incidencias_pendientes > 0 %}
            <a
              href="{{ url_for('admin.incidencias') }}?estado=Abierta"
              class="btn btn-danger btn-sm"
            >
              <i class="bi bi-exclamation-triangle"></i> Resolver {{
              stats.incidencias_pendientes }} Incidencias
            </a>
            {% endif %}

            <a
              href="{{ url_for('admin.categorias') }}"
              class="btn btn-primary btn-sm"
            >
              <i class="bi bi-plus-circle"></i> Nueva Categoría
            </a>

            <a
              href="{{ url_for('admin.reportes') }}"
              class="btn btn-info btn-sm"
            >
              <i class="bi bi-download"></i> Generar Reporte
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Contenido Principal -->
    <div class="col-lg-9">
      <!-- Alertas y Notificaciones -->
      {% if stats.objetos_pendientes > 0 or stats.incidencias_pendientes > 0 %}
      <div class="row mb-4">
        {% if stats.objetos_pendientes > 0 %}
        <div class="col-md-6">
          <div class="alert alert-warning d-flex align-items-center">
            <i class="bi bi-exclamation-triangle-fill me-2 fs-4"></i>
            <div>
              <strong>{{ stats.objetos_pendientes }} objetos</strong> pendientes
              de revisión
              <br />
              <a
                href="{{ url_for('admin.objetos') }}?estado=pendiente"
                class="alert-link"
                >Revisar ahora</a
              >
            </div>
          </div>
        </div>
        {% endif %} {% if stats.incidencias_pendientes > 0 %}
        <div class="col-md-6">
          <div class="alert alert-danger d-flex align-items-center">
            <i class="bi bi-exclamation-triangle-fill me-2 fs-4"></i>
            <div>
              <strong>{{ stats.incidencias_pendientes }} incidencias</strong>
              requieren atención
              <br />
              <a
                href="{{ url_for('admin.incidencias') }}?estado=Abierta"
                class="alert-link"
                >Resolver ahora</a
              >
            </div>
          </div>
        </div>
        {% endif %}
      </div>
      {% endif %}

      <div class="row">
        <!-- Actividad Reciente -->
        <div class="col-md-8">
          <div class="card mb-4">
            <div
              class="card-header d-flex justify-content-between align-items-center"
            >
              <h6 class="mb-0">
                <i class="bi bi-clock-history"></i> Actividad Reciente
              </h6>
              <a
                href="{{ url_for('admin.reportes') }}"
                class="btn btn-sm btn-outline-primary"
                >Ver Todo</a
              >
            </div>
            <div class="card-body">
              {% if actividad_reciente %}
              <div class="list-group list-group-flush">
                {% for actividad in actividad_reciente %}
                <div
                  class="list-group-item d-flex justify-content-between align-items-start"
                >
                  <div class="flex-grow-1">
                    <div class="d-flex justify-content-between">
                      <strong class="mb-1">{{ actividad.titulo }}</strong>
                      <small class="text-muted"
                        >{{ actividad.fecha.strftime('%H:%M') }}</small
                      >
                    </div>
                    <p class="mb-1 small">{{ actividad.descripcion }}</p>
                    <small class="text-muted"
                      >{{ actividad.fecha.strftime('%d/%m/%Y') }}</small
                    >
                  </div>
                  <span class="badge bg-{{ actividad.tipo }} rounded-pill"
                    >{{ actividad.tipo|title }}</span
                  >
                </div>
                {% endfor %}
              </div>
              {% else %}
              <div class="text-center py-4">
                <i class="bi bi-activity display-4 text-muted"></i>
                <p class="text-muted mt-3">No hay actividad reciente</p>
              </div>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- Estadísticas Rápidas -->
        <div class="col-md-4">
          <div class="card mb-4">
            <div class="card-header">
              <h6 class="mb-0">
                <i class="bi bi-graph-up"></i> Resumen del Día
              </h6>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <small class="text-muted">Nuevos Usuarios</small>
                <div class="d-flex justify-content-between">
                  <strong>{{ stats.nuevos_usuarios_hoy }}</strong>
                  {% if stats.nuevos_usuarios_hoy > 0 %}
                  <span class="text-success small">
                    <i class="bi bi-arrow-up"></i> +{{ stats.nuevos_usuarios_hoy
                    }}
                  </span>
                  {% endif %}
                </div>
              </div>

              <div class="mb-3">
                <small class="text-muted">Nuevos Objetos</small>
                <div class="d-flex justify-content-between">
                  <strong>{{ stats.nuevos_objetos_hoy }}</strong>
                  {% if stats.nuevos_objetos_hoy > 0 %}
                  <span class="text-success small">
                    <i class="bi bi-arrow-up"></i> +{{ stats.nuevos_objetos_hoy
                    }}
                  </span>
                  {% endif %}
                </div>
              </div>

              <div class="mb-3">
                <small class="text-muted">Reservas Hoy</small>
                <div class="d-flex justify-content-between">
                  <strong>{{ stats.reservas_hoy }}</strong>
                  {% if stats.reservas_hoy > 0 %}
                  <span class="text-success small">
                    <i class="bi bi-arrow-up"></i> +{{ stats.reservas_hoy }}
                  </span>
                  {% endif %}
                </div>
              </div>

              <div>
                <small class="text-muted">Ingresos Hoy</small>
                <div class="d-flex justify-content-between">
                  <strong>RD$ {{ "%.2f"|format(stats.ingresos_hoy) }}</strong>
                  {% if stats.ingresos_hoy > 0 %}
                  <span class="text-success small">
                    <i class="bi bi-arrow-up"></i> +{{ stats.ingresos_hoy }}
                  </span>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Secciones Adicionales -->
      <div class="row">
        <!-- Usuarios Recientes -->
        <div class="col-md-6">
          <div class="card">
            <div
              class="card-header d-flex justify-content-between align-items-center"
            >
              <h6 class="mb-0">
                <i class="bi bi-person-plus"></i> Usuarios Recientes
              </h6>
              <a
                href="{{ url_for('admin.usuarios') }}"
                class="btn btn-sm btn-outline-primary"
                >Ver Todos</a
              >
            </div>
            <div class="card-body">
              {% if usuarios_recientes %}
              <div class="list-group list-group-flush">
                {% for usuario in usuarios_recientes %}
                <div
                  class="list-group-item d-flex justify-content-between align-items-center"
                >
                  <div>
                    <strong>{{ usuario.nombre }} {{ usuario.apellido }}</strong>
                    <br />
                    <small class="text-muted">{{ usuario.correo }}</small>
                  </div>
                  <div class="text-end">
                    <small class="text-muted d-block"
                      >{{ usuario.fecha_registro.strftime('%d/%m') }}</small
                    >
                    <span
                      class="badge bg-{{ 'danger' if usuario.id_rol == 1 else 'primary' }} small"
                    >
                      {% if usuario.id_rol == 1 %}Admin{% else %}Usuario{% endif
                      %}
                    </span>
                  </div>
                </div>
                {% endfor %}
              </div>
              {% else %}
              <p class="text-muted text-center py-3">
                No hay usuarios recientes
              </p>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- Objetos Recientes -->
        <div class="col-md-6">
          <div class="card">
            <div
              class="card-header d-flex justify-content-between align-items-center"
            >
              <h6 class="mb-0">
                <i class="bi bi-plus-circle"></i> Objetos Recientes
              </h6>
              <a
                href="{{ url_for('admin.objetos') }}"
                class="btn btn-sm btn-outline-primary"
                >Ver Todos</a
              >
            </div>
            <div class="card-body">
              {% if objetos_recientes %}
              <div class="list-group list-group-flush">
                {% for objeto in objetos_recientes %}
                <div
                  class="list-group-item d-flex justify-content-between align-items-center"
                >
                  <div class="text-truncate" style="max-width: 180px">
                    <strong>{{ objeto.nombre }}</strong>
                    <br />
                    <small class="text-muted"
                      >RD$ {{ "%.2f"|format(objeto.precio) }}</small
                    >
                  </div>
                  <div class="text-end">
                    <small class="text-muted d-block"
                      >{{ objeto.fecha_publicacion.strftime('%d/%m') }}</small
                    >
                    <span
                      class="badge bg-{{ 
                                            'warning' if objeto.estado == 'Pendiente' 
                                            else 'success' if objeto.estado == 'Aprobado'
                                            else 'danger' if objeto.estado == 'Rechazado'
                                            else 'secondary'
                                        }} small"
                    >
                      {{ objeto.estado }}
                    </span>
                  </div>
                </div>
                {% endfor %}
              </div>
              {% else %}
              <p class="text-muted text-center py-3">
                No hay objetos recientes
              </p>
              {% endif %}
            </div>
          </div>
        </div>
      </div>

      <!-- Sistema y Estado -->
      <div class="row mt-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h6 class="mb-0">
                <i class="bi bi-heart-pulse"></i> Estado del Sistema
              </h6>
            </div>
            <div class="card-body">
              <div class="row text-center">
                <div class="col-md-3 mb-3">
                  <i class="bi bi-database text-primary fs-1"></i>
                  <h6 class="mt-2">Base de Datos</h6>
                  <span class="badge bg-success">Conectada</span>
                </div>
                <div class="col-md-3 mb-3">
                  <i class="bi bi-server text-success fs-1"></i>
                  <h6 class="mt-2">Servidor</h6>
                  <span class="badge bg-success">En Línea</span>
                </div>
                <div class="col-md-3 mb-3">
                  <i class="bi bi-shield-check text-warning fs-1"></i>
                  <h6 class="mt-2">Seguridad</h6>
                  <span class="badge bg-success">Activa</span>
                </div>
                <div class="col-md-3 mb-3">
                  <i class="bi bi-clock-history text-info fs-1"></i>
                  <h6 class="mt-2">Última Copia</h6>
                  <span class="badge bg-secondary">Hoy 02:00</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Script para actualizaciones automáticas -->
<script>
  // Actualizar estadísticas cada 30 segundos (opcional)
  function actualizarEstadisticas() {
    fetch("/admin/api/estadisticas")
      .then((response) => response.json())
      .then((data) => {
        // Actualizar los contadores en el dashboard
        document.querySelectorAll("[data-stat]").forEach((element) => {
          const statName = element.getAttribute("data-stat");
          if (data[statName] !== undefined) {
            element.textContent = data[statName];
          }
        });
      })
      .catch((error) =>
        console.error("Error actualizando estadísticas:", error)
      );
  }

  // Iniciar actualizaciones automáticas (descomentar si se implementa la API)
  // setInterval(actualizarEstadisticas, 30000);

  // Inicializar tooltips
  document.addEventListener("DOMContentLoaded", function () {
    var tooltipTriggerList = [].slice.call(
      document.querySelectorAll('[data-bs-toggle="tooltip"]')
    );
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl);
    });
  });
</script>
{% endblock %}
