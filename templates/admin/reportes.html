{% extends "base.html" %} {% block title %}Reportes y Estadísticas - Rentflow{%
endblock %} {% block content %}
<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h2"><i class="bi bi-graph-up"></i> Reportes y Estadísticas</h1>
    <div class="btn-group">
      <button
        class="btn btn-outline-primary dropdown-toggle"
        type="button"
        data-bs-toggle="dropdown"
      >
        <i class="bi bi-download"></i> Exportar Reporte
      </button>
      <ul class="dropdown-menu">
        <li><a class="dropdown-item" href="#">PDF</a></li>
        <li><a class="dropdown-item" href="#">Excel</a></li>
        <li><a class="dropdown-item" href="#">CSV</a></li>
      </ul>
    </div>
  </div>

  <!-- Filtros de Fecha -->
  <div class="card mb-4">
    <div class="card-body">
      <div class="row g-3 align-items-end">
        <div class="col-md-3">
          <label class="form-label">Fecha desde</label>
          <input
            type="date"
            class="form-control"
            id="fechaDesde"
            value="{{ fecha_inicio }}"
          />
        </div>
        <div class="col-md-3">
          <label class="form-label">Fecha hasta</label>
          <input
            type="date"
            class="form-control"
            id="fechaHasta"
            value="{{ fecha_fin }}"
          />
        </div>
        <div class="col-md-3">
          <label class="form-label">Tipo de reporte</label>
          <select class="form-select" id="tipoReporte">
            <option value="general">General</option>
            <option value="usuarios">Usuarios</option>
            <option value="transacciones">Transacciones</option>
            <option value="objetos">Objetos</option>
          </select>
        </div>
        <div class="col-md-3">
          <button class="btn btn-primary w-100" onclick="generarReporte()">
            <i class="bi bi-arrow-repeat"></i> Generar Reporte
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Estadísticas Principales -->
  <div class="row mb-4">
    <div class="col-xl-3 col-md-6 mb-4">
      <div class="card border-start border-primary border-4 shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div
                class="text-xs font-weight-bold text-primary text-uppercase mb-1"
              >
                Ingresos Totales
              </div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">
                RD$ {{ "%.2f"|format(estadisticas.ingresos_totales) }}
              </div>
            </div>
            <div class="col-auto">
              <i class="bi bi-currency-dollar fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
      <div class="card border-start border-success border-4 shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div
                class="text-xs font-weight-bold text-success text-uppercase mb-1"
              >
                Reservas Completadas
              </div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">
                {{ estadisticas.reservas_completadas }}
              </div>
            </div>
            <div class="col-auto">
              <i class="bi bi-calendar-check fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
      <div class="card border-start border-info border-4 shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div
                class="text-xs font-weight-bold text-info text-uppercase mb-1"
              >
                Nuevos Usuarios
              </div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">
                {{ estadisticas.nuevos_usuarios }}
              </div>
            </div>
            <div class="col-auto">
              <i class="bi bi-person-plus fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
      <div class="card border-start border-warning border-4 shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div
                class="text-xs font-weight-bold text-warning text-uppercase mb-1"
              >
                Objetos Publicados
              </div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">
                {{ estadisticas.objetos_publicados }}
              </div>
            </div>
            <div class="col-auto">
              <i class="bi bi-grid fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- Gráficos -->
    <div class="col-lg-8">
      <div class="card mb-4">
        <div class="card-header">
          <h6 class="mb-0">
            <i class="bi bi-bar-chart"></i> Actividad Mensual
          </h6>
        </div>
        <div class="card-body">
          <div
            class="chart-container"
            style="position: relative; height: 300px"
          >
            <!-- Aquí iría un gráfico con Chart.js o similar -->
            <div class="text-center py-5 text-muted">
              <i class="bi bi-bar-chart display-4"></i>
              <p class="mt-3">Gráfico de actividad mensual</p>
              <small>Se mostrarían reservas, usuarios y ingresos por mes</small>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">
              <h6 class="mb-0">
                <i class="bi bi-pie-chart"></i> Distribución por Categoría
              </h6>
            </div>
            <div class="card-body">
              <div
                class="chart-container"
                style="position: relative; height: 250px"
              >
                <div class="text-center py-4 text-muted">
                  <i class="bi bi-pie-chart display-4"></i>
                  <p class="mt-3">Gráfico de categorías</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">
              <h6 class="mb-0">
                <i class="bi bi-geo-alt"></i> Distribución Geográfica
              </h6>
            </div>
            <div class="card-body">
              <div
                class="chart-container"
                style="position: relative; height: 250px"
              >
                <div class="text-center py-4 text-muted">
                  <i class="bi bi-map display-4"></i>
                  <p class="mt-3">Mapa de usuarios</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Datos Detallados -->
    <div class="col-lg-4">
      <div class="card mb-4">
        <div class="card-header">
          <h6 class="mb-0"><i class="bi bi-trophy"></i> Top Propietarios</h6>
        </div>
        <div class="card-body">
          {% for propietario in top_propietarios %}
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
              <strong>{{ propietario.nombre }}</strong>
              <br />
              <small class="text-muted"
                >{{ propietario.objetos }} objetos</small
              >
            </div>
            <span class="badge bg-success"
              >RD$ {{ "%.2f"|format(propietario.ingresos) }}</span
            >
          </div>
          {% endfor %}
        </div>
      </div>

      <div class="card mb-4">
        <div class="card-header">
          <h6 class="mb-0"><i class="bi bi-star"></i> Objetos Más Populares</h6>
        </div>
        <div class="card-body">
          {% for objeto in objetos_populares %}
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="text-truncate" style="max-width: 150px">
              <strong>{{ objeto.nombre }}</strong>
              <br />
              <small class="text-muted">{{ objeto.reservas }} reservas</small>
            </div>
            <span class="badge bg-warning"
              >⭐ {{ "%.1f"|format(objeto.calificacion) }}</span
            >
          </div>
          {% endfor %}
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h6 class="mb-0"><i class="bi bi-clock-history"></i> Tendencias</h6>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <small class="text-success">
              <i class="bi bi-arrow-up"></i>
              <strong>+15%</strong> crecimiento en reservas
            </small>
          </div>
          <div class="mb-3">
            <small class="text-success">
              <i class="bi bi-arrow-up"></i>
              <strong>+8%</strong> nuevos usuarios
            </small>
          </div>
          <div class="mb-3">
            <small class="text-danger">
              <i class="bi bi-arrow-down"></i>
              <strong>-5%</strong> categoría "Electrodomésticos"
            </small>
          </div>
          <div>
            <small class="text-success">
              <i class="bi bi-arrow-up"></i>
              <strong>+20%</strong> categoría "Herramientas"
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function generarReporte() {
    const fechaDesde = document.getElementById("fechaDesde").value;
    const fechaHasta = document.getElementById("fechaHasta").value;
    const tipoReporte = document.getElementById("tipoReporte").value;

    // Aquí iría la lógica para generar el reporte
    console.log("Generando reporte:", { fechaDesde, fechaHasta, tipoReporte });

    // Simular carga de datos
    alert(
      "Reporte generado para el período " + fechaDesde + " al " + fechaHasta
    );
  }
</script>
{% endblock %}
