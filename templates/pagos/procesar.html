{% extends "base.html" %} {% block title %}Procesar Pago - Rentflow{% endblock
%} {% block content %}
<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-lg-6">
      <div class="card shadow">
        <div class="card-header bg-success text-white">
          <h4 class="mb-0"><i class="bi bi-credit-card"></i> Procesar Pago</h4>
        </div>
        <div class="card-body p-4">
          <!-- Resumen de la Reserva -->
          <div class="card mb-4">
            <div class="card-header bg-light">
              <h6 class="mb-0">Resumen de la Reserva</h6>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-6">
                  <strong>Objeto:</strong>
                </div>
                <div class="col-6 text-end">{{ reserva.objeto.nombre }}</div>
              </div>
              <div class="row">
                <div class="col-6">
                  <strong>Período:</strong>
                </div>
                <div class="col-6 text-end">
                  {{ reserva.fecha_inicio.strftime('%d/%m/%Y') }} - {{
                  reserva.fecha_fin.strftime('%d/%m/%Y') }}
                </div>
              </div>
              <div class="row">
                <div class="col-6">
                  <strong>Días:</strong>
                </div>
                <div class="col-6 text-end">
                  {{ (reserva.fecha_fin - reserva.fecha_inicio).days }} días
                </div>
              </div>
              <div class="row">
                <div class="col-6">
                  <strong>Precio/día:</strong>
                </div>
                <div class="col-6 text-end">
                  RD$ {{ "%.2f"|format(reserva.objeto.precio) }}
                </div>
              </div>
              <hr />
              <div class="row">
                <div class="col-6">
                  <h6 class="mb-0">Total a pagar:</h6>
                </div>
                <div class="col-6 text-end">
                  <h5 class="text-success mb-0">
                    RD$ {{ "%.2f"|format(monto_total) }}
                  </h5>
                </div>
              </div>
            </div>
          </div>

          <form method="POST">
            {{ form.hidden_tag() }}

            <!-- Método de Pago -->
            <h5 class="mb-3 text-primary">
              <i class="bi bi-wallet2"></i> Método de Pago
            </h5>

            <div class="mb-4">
              <div class="form-check mb-3">
                <input
                  class="form-check-input"
                  type="radio"
                  name="metodo"
                  id="tarjeta"
                  value="Tarjeta"
                  checked
                />
                <label class="form-check-label" for="tarjeta">
                  <i class="bi bi-credit-card-2-front"></i> Tarjeta de
                  Crédito/Débito
                </label>
              </div>
              <div class="form-check mb-3">
                <input
                  class="form-check-input"
                  type="radio"
                  name="metodo"
                  id="transferencia"
                  value="Transferencia"
                />
                <label class="form-check-label" for="transferencia">
                  <i class="bi bi-bank"></i> Transferencia Bancaria
                </label>
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="radio"
                  name="metodo"
                  id="efectivo"
                  value="Efectivo"
                />
                <label class="form-check-label" for="efectivo">
                  <i class="bi bi-cash"></i> Efectivo (Al recoger)
                </label>
              </div>
            </div>

            <!-- Información de Tarjeta (mostrar dinámicamente) -->
            <div id="infoTarjeta" class="mb-4">
              <div class="row">
                <div class="col-12 mb-3">
                  <label class="form-label">Número de Tarjeta</label>
                  <input
                    type="text"
                    class="form-control"
                    placeholder="1234 5678 9012 3456"
                    maxlength="19"
                  />
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Fecha de Vencimiento</label>
                  <input
                    type="text"
                    class="form-control"
                    placeholder="MM/AA"
                    maxlength="5"
                  />
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">CVV</label>
                  <input
                    type="text"
                    class="form-control"
                    placeholder="123"
                    maxlength="3"
                  />
                </div>
                <div class="col-12 mb-3">
                  <label class="form-label">Nombre en la Tarjeta</label>
                  <input
                    type="text"
                    class="form-control"
                    placeholder="JUAN PEREZ"
                  />
                </div>
              </div>
            </div>

            <!-- Información de Transferencia -->
            <div id="infoTransferencia" class="mb-4" style="display: none">
              <div class="alert alert-info">
                <h6>
                  <i class="bi bi-info-circle"></i> Instrucciones para
                  Transferencia
                </h6>
                <p class="mb-2">Realiza la transferencia a:</p>
                <ul class="mb-2">
                  <li><strong>Banco:</strong> Banco Popular</li>
                  <li><strong>Cuenta:</strong> 123-456789-1</li>
                  <li><strong>Nombre:</strong> Rentflow RD</li>
                  <li>
                    <strong>Monto:</strong> RD$ {{ "%.2f"|format(monto_total) }}
                  </li>
                </ul>
                <p class="mb-0">
                  Envía el comprobante a: comprobantes@rentflow.com
                </p>
              </div>
            </div>

            <!-- Información de Efectivo -->
            <div id="infoEfectivo" class="mb-4" style="display: none">
              <div class="alert alert-warning">
                <h6>
                  <i class="bi bi-exclamation-triangle"></i> Pago en Efectivo
                </h6>
                <p class="mb-0">
                  Deberás pagar el monto total al momento de recoger el objeto.
                  Asegúrate de coordinar con el propietario.
                </p>
              </div>
            </div>

            <!-- Botones -->
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
              <a
                href="{{ url_for('reservas.listar_reservas') }}"
                class="btn btn-outline-secondary me-md-2"
              >
                <i class="bi bi-arrow-left"></i> Cancelar
              </a>
              <button type="submit" class="btn btn-success btn-lg">
                <i class="bi bi-check-circle"></i> Confirmar Pago
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Script para mostrar/ocultar información de pago -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const tarjetaRadio = document.getElementById("tarjeta");
    const transferenciaRadio = document.getElementById("transferencia");
    const efectivoRadio = document.getElementById("efectivo");
    const infoTarjeta = document.getElementById("infoTarjeta");
    const infoTransferencia = document.getElementById("infoTransferencia");
    const infoEfectivo = document.getElementById("infoEfectivo");

    function actualizarInfoPago() {
      infoTarjeta.style.display = "none";
      infoTransferencia.style.display = "none";
      infoEfectivo.style.display = "none";

      if (tarjetaRadio.checked) {
        infoTarjeta.style.display = "block";
      } else if (transferenciaRadio.checked) {
        infoTransferencia.style.display = "block";
      } else if (efectivoRadio.checked) {
        infoEfectivo.style.display = "block";
      }
    }

    tarjetaRadio.addEventListener("change", actualizarInfoPago);
    transferenciaRadio.addEventListener("change", actualizarInfoPago);
    efectivoRadio.addEventListener("change", actualizarInfoPago);

    // Inicializar
    actualizarInfoPago();
  });
</script>
{% endblock %}
