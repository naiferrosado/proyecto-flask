{% extends "base.html" %} {% block title %}Mis Reservas - Rentflow{% endblock %}
{% block content %}

<div class="container py-5">
  <!-- Encabezado -->
  <div class="row mb-5">
    <div class="col-12">
      <h1 class="h2 fw-bold" style="color: #343a40">
        <i
          class="fa-solid fa-calendar-check me-2"
          style="color: var(--bs-primary)"
        ></i>
        Mis Reservas
      </h1>
      <p class="text-muted lead">
        Revisa el estado de los objetos que has alquilado y realiza el pago.
      </p>
    </div>
  </div>

  <!-- Contenedor -->
  <div class="card border-0 rounded-4 shadow-lg p-lg-3">
    <div class="card-body">
      {% if reservas %}
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead>
            <tr class="small text-uppercase">
              <th>Objeto</th>
              <th>Fechas</th>
              <th>Estado</th>
              <th>Fecha Reserva</th>
              <th class="text-end">Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for reserva in reservas %}
            <tr>
              <!-- Objeto -->
              <td>
                <div class="d-flex align-items-center">
                  <img
                    src="{{ reserva.objeto.imagen or 'https://placehold.co/50x50/f4f4f4/333333?text=IMG' }}"
                    class="rounded-3 me-3"
                    style="width: 50px; height: 50px; object-fit: cover"
                  />
                  <div>
                    <a
                      href="{{ url_for('objetos.detalle_objeto', id_objeto=reserva.objeto.id_objeto) }}"
                      class="text-dark fw-bold text-decoration-none d-block"
                    >
                      {{ reserva.objeto.nombre }}
                    </a>
                    <small class="text-muted">
                      {{ reserva.objeto.categoria.nombre }}
                    </small>
                  </div>
                </div>
              </td>

              <!-- Fechas -->
              <td>
                <span class="d-block small fw-bold text-dark">
                  {{ reserva.fecha_inicio.strftime('%d/%m/%Y') }}
                </span>
                <span class="d-block small text-muted">
                  hasta {{ reserva.fecha_fin.strftime('%d/%m/%Y') }}
                </span>
              </td>

              <!-- Estado -->
              <td>
                {% set status_class = { 'Pendiente': 'warning', 'Activa':
                'primary', 'Confirmada': 'success', 'Completada': 'success',
                'Cancelada': 'danger' }.get(reserva.estado, 'secondary') %}

                <span
                  class="badge bg-{{ status_class }} text-uppercase py-2 px-3 fw-bold"
                >
                  {{ reserva.estado }}
                </span>
              </td>

              <!-- Fecha de reserva -->
              <td>
                <small class="text-muted">
                  {{ reserva.fecha_reserva.strftime('%d/%m/%Y') }}
                </small>
              </td>

              <!-- Acciones -->
              <td class="text-end">
                {% if reserva.estado == 'Pendiente' %}

                <!-- Botón Pagar -->
                <a
                  href="{{ url_for('pagos.procesar_pago', id_reserva=reserva.id_reserva) }}"
                  class="btn btn-sm btn-success rounded-pill me-2"
                  data-bs-toggle="tooltip"
                  title="Realizar Pago"
                >
                  <i class="fa-solid fa-credit-card"></i>
                </a>

                <!-- Botón Cancelar -->
                <a
                  href="{{ url_for('reservas.cancelar_reserva', id=reserva.id_reserva) }}"
                  class="btn btn-sm btn-outline-danger rounded-pill"
                  data-bs-toggle="tooltip"
                  title="Cancelar Reserva"
                >
                  <i class="fa-solid fa-times"></i>
                </a>

                {% elif reserva.estado == 'Confirmada' or reserva.estado ==
                'Activa' %}

                <span class="text-muted small me-2 fw-bold text-success">
                  Pagado ✓
                </span>

                <a
                  href="{{ url_for('reservas.cancelar_reserva', id=reserva.id_reserva) }}"
                  class="btn btn-sm btn-outline-danger rounded-pill"
                  title="Cancelar Reserva"
                >
                  <i class="fa-solid fa-times"></i>
                </a>

                {% else %}
                <span class="text-muted small">Finalizado</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      {% else %}
      <!-- Estado vacío -->
      <div class="text-center py-5 bg-light rounded-3">
        <i class="fa-solid fa-inbox fa-3x text-muted"></i>
        <h4 class="text-muted mt-3 fw-bold">Aún no tienes reservas</h4>
        <p class="text-muted mb-4">
          Empieza a explorar y alquilar objetos cerca de ti.
        </p>
        <a
          href="{{ url_for('objetos.listar_objetos') }}"
          class="btn btn-main-action fw-bold rounded-pill px-4"
        >
          <i class="fa-solid fa-search me-2"></i> Explorar Objetos
        </a>
      </div>
      {% endif %}
    </div>
  </div>
</div>

{% endblock %}
